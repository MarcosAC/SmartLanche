name: Create Epics
on:
  workflow_dispatch:

permissions:
  issues: write
  contents: read

jobs:
  create-epics:
    runs-on: ubuntu-latest

    steps:
      - name: Create epic issues
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const epics = [
              {
                title: "ÉPICO 1 — Sistema de Pedidos",
                body: `
                  ### Features
                  - 1.1 Criar Pedido
                  - 1.2 Acompanhar Pedido
                  
                  ### Histórias
                  - US-001 Criar pedido manualmente
                  - US-002 Adicionar itens ao pedido
                  - US-003 Excluir/alterar itens
                  - US-004 Visualizar pedidos em aberto
                  - US-005 Atualizar status
                  
                  ### Tarefas
                  - Criar tela de novo pedido
                  - Criar model Pedido
                  - Criar model ItemPedido
                  - Persistência local (SQLite ou EF)
                  - Calcular total automaticamente
                  - Integração com fluxo da cozinha
                  - Notificações visuais
                                  `
                                },
                                {
                                  title: "ÉPICO 2 — Sistema da Cozinha",
                                  body: `
                  ### Features
                  - 2.1 Visualização dos pedidos
                  - 2.2 Conclusão do pedido
                  
                  ### Histórias
                  - US-006 Tela da cozinha atualizando em tempo real
                  - US-007 Ordenar por ordem de chegada
                  - US-008 Marcar pedido como pronto
                                  `
                                },
                                {
                                  title: "ÉPICO 3 — Catálogo de Produtos",
                                  body: `
                  ### Features
                  - CRUD de produtos
                  
                  ### Histórias
                  - US-009 Cadastrar produtos
                  - US-010 Editar produtos
                  - US-011 Excluir produtos
                                  `
                                },
                                {
                                  title: "ÉPICO 4 — Multi-Lanchonete",
                                  body: `
                  ### Features
                  - Identidade visual
                  - Configurações SMTP
                  
                  ### Histórias
                  - US-012 Definir nome, logo e cores
                  - US-013 Cadastrar SMTP
                  - US-014 Teste de envio
                  - US-015 Envio automático no final do pedido
                                  `
                                },
                                {
                                  title: "ÉPICO 5 — Relatórios",
                                  body: `
                  ### Features
                  - Relatório diário
                  
                  ### Histórias
                  - US-016 Ver total do dia
                  - US-017 Ver itens mais vendidos
                                  `
                                },
                                {
                                  title: "ÉPICO 6 — Administração",
                                  body: `
                  ### Histórias
                  - US-018 Gerenciar usuários
                  - US-019 Restringir acessos
                                  `
              }
            ];

            for (const epic of epics) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: epic.title,
                body: epic.body,
                labels: ["epic"]
              });
            }
