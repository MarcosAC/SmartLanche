name: Populate Epics
on:
  workflow_dispatch:

permissions:
  issues: write
  contents: read

jobs:
  epics:
    runs-on: ubuntu-latest

    steps:
      - name: Create epic issues
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const items = [
              `ÉPICO 1 — Sistema de Pedidos

              Feature 1.1 — Criar Pedido
              Histórias:
              - US-001 – Criar pedido manualmente (Como atendente quero registrar um pedido para enviar à cozinha)
              - US-002 – Adicionar itens ao pedido
              - US-003 – Excluir/alterar itens
              Tarefas:
              - Criar tela de novo pedido
              - Criar model Pedido
              - Criar model ItemPedido
              - Persistência local (SQLite ou EF)
              - Calcular total automaticamente
              - Validações
              
              Feature 1.2 — Acompanhar Pedido
              Histórias:
              - US-004 – Visualizar pedidos em aberto
              - US-005 – Atualizar status (A Fazer, Em Preparo, Pronto)
              Tarefas:
              - Tela: Lista de pedidos
              - Integração com fluxo da cozinha
              - Atualizar status
              - Notificações visuais`,
              
                            `ÉPICO 2 — Sistema da Cozinha
              
              Feature 2.1 — Visualização dos Pedidos
              Histórias:
              - US-006 – Tela da cozinha atualizando em tempo real
              - US-007 – Ordenar por ordem de chegada
              
              Feature 2.2 — Conclusão de Pedido
              Histórias:
              - US-008 – Marcar pedido como pronto
              Tarefas:
              - Conectar com o banco
              - Atualização automática
              - Filtrar pedidos prontos`,
              
                            `ÉPICO 3 — Catálogo de Produtos
              
              Feature 3.1 — CRUD de Produtos
              Histórias:
              - US-009 – Cadastrar produtos
              - US-010 – Editar produtos
              - US-011 – Excluir produtos
              Tarefas:
              - Tela de cadastro
              - Persistência
              - Upload de imagens
              - Preço e descrição
              - Logotipo customizado por lanchonete`,
              
                            `ÉPICO 4 — Multi-Lanchonete (Multi-Tenant)
              
              Feature 4.1 — Identidade Visual
              - US-012 – Cada lanchonete define nome, logo e cores
              
              Feature 4.2 — SMTP Configurável
              - US-013 – Usuário cadastra credenciais SMTP
              - US-014 – Teste de envio
              - US-015 – Envio automático no final do pedido
              Tarefas:
              - Criar tela de Configurações
              - Criptografar credenciais localmente
              - Implementar envio via SMTP (ssl/tls)`,
              
                            `ÉPICO 5 — Relatórios
              
              Feature 5.1 — Relatório Diário
              Histórias:
              - US-016 – Ver total do dia
              - US-017 – Ver itens mais vendidos
              Tarefas:
              - Tela + filtros
              - Exportar PDF
              - Exportar CSV`,
              
                            `ÉPICO 6 — Administração
              
              Histórias:
              - US-018 – Gerenciar usuários (admin, atendente, cozinha)
              - US-019 – Restringir acessos`
            ];

            for (const body of items) {
              // O título será a primeira linha do texto do épico
              const title = body.split("\n")[0];

              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title,
                body,
                labels: ["epic"]
              });
            }
