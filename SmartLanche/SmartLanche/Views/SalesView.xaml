<UserControl x:Class="SmartLanche.Views.SalesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SmartLanche.Views"
             xmlns:models="clr-namespace:SmartLanche.Models"
             xmlns:helpers="clr-namespace:SmartLanche.Helpers"              
             mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="1200">    

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <DockPanel Grid.Column="0" Margin="0,0,16,0">
            <GroupBox Header="Cardápio: Clique para adicionar" 
                      DockPanel.Dock="Top"
                      Margin="0,0,0,10">  

                <DataGrid ItemsSource="{Binding Products}"
                          SelectedItem="{Binding SelectedProduct, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          GridLinesVisibility="None"
                          Background="White">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Nome"
                                            Binding="{Binding Name}"
                                            Width="2*" />

                        <DataGridTextColumn Header="Preço"
                                            Binding="{Binding Price, StringFormat={}{0:C}}"
                                            ElementStyle="{StaticResource NumericDataGridColumnStyle}"
                                            Width="1*" />

                        <DataGridTextColumn Header="Categoria"
                                            Binding="{Binding Category}"
                                            Width="1.5*" />
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>            
        </DockPanel>
        
        <GridSplitter Grid.Column="1"
                      Width="5"
                      HorizontalAlignment="Center"
                      ResizeBehavior="PreviousAndNext" />

        <DockPanel Grid.Column="2" Margin="16,0,0,0">
            <TextBlock DockPanel.Dock="Top"
                       Text="Carrinho"
                       FontSize="20"
                       FontWeight="Bold"
                       Margin="0,0,0,10" />

            <DataGrid DockPanel.Dock="Top"
                      ItemsSource="{Binding CartItems}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Height="300"
                      Margin="0,0,0,16">

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Produto"
                                        Binding="{Binding Product.Name}"
                                        Width="*" />

                    <DataGridTextColumn Header="Preço Unit."
                                        Binding="{Binding UnitPrice, StringFormat={}{0:C}}"
                                        ElementStyle="{StaticResource NumericDataGridColumnStyle}"
                                        Width="100" />

                    <DataGridTemplateColumn Header="Quantidade" Width="110">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="-" 
                                            Width="25" Margin="2"
                                            Command="{Binding DataContext.DecreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}" />

                                    <TextBlock Text="{Binding Quantity}" 
                                               VerticalAlignment="Center" 
                                               FontWeight="Bold" 
                                               Margin="5,0" />

                                    <Button Content="+" 
                                            Width="25"
                                            Margin="2"
                                            Command="{Binding DataContext.IncreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="Subtotal"
                                        Binding="{Binding Subtotal, StringFormat={}{0:C}}"
                                        ElementStyle="{StaticResource NumericDataGridColumnStyle}"
                                        Width="100" />

                    <DataGridTemplateColumn Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Remover"
                                        Command="{Binding DataContext.RemoveItemFromCartCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                                        CommandParameter="{Binding}"
                                        Margin="2" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <StackPanel DockPanel.Dock="Right" Margin="0,0,0,16">
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="TOTAL:"
                               FontSize="24"
                               FontWeight="Bold" />

                    <TextBlock Grid.Column="1"
                               Text="{Binding TotalOrderAmount, StringFormat={}{0:C}}"
                               FontSize="24"
                               FontWeight="Bold"
                               HorizontalAlignment="Right"
                               Margin="10,0,0,0" />
                </Grid>

                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Column="0"
                               Grid.Row="0"
                               Text="Forma de Pagamento"
                               Margin="0,0,0,5"
                               FontWeight="SemiBold" />

                    <ComboBox Grid.Column="0"
                              Grid.Row="1"
                              ItemsSource="{Binding Source={helpers:EnumValuesExtension {x:Type helpers:PaymentMethod}}}"
                              DisplayMemberPath="DisplayName"
                              SelectedValuePath="Value"
                              SelectedValue="{Binding SelectedPaymentMethod, Mode=TwoWay}"
                              Width="115"
                              HorizontalAlignment="Left"
                              Margin="0,0,0,10" />

                    <TextBlock Grid.Column="1"
                               Grid.Row="0"
                               Text="Cliente"
                               Margin="10,0,0,0"
                               FontWeight="SemiBold" />

                    <ComboBox Grid.Column="1"
                              Grid.Row="1"
                              ItemsSource="{Binding Clients}"
                              SelectedItem="{Binding SelectedClient, Mode=TwoWay}"
                              DisplayMemberPath="Name"
                              IsEnabled="{Binding CanBeCredit}"
                              Margin="10,0,0,10" />
                </Grid>

                <Button Content="FINALIZAR PEDIDO"
                        Command="{Binding FinalizeOrderCommand}"
                        FontSize="20"
                        Padding="10"
                        Background="#FF4CAF50"
                        Foreground="White" />
            </StackPanel>
        </DockPanel>
    </Grid>
</UserControl>
